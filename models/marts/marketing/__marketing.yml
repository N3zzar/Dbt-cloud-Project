version: 2

models:
  - name: customer_cohorts
    description: "Marketing-focused customer cohorts table: shows customer retention and revenue by cohort month and order month."
    columns:
      - name: cohort_month
        description: "Month of the customer's first order (cohort assignment)."
        tests:
          - not_null
          - unique

      - name: order_month
        description: "Month in which the order was placed, used to track cohort activity."
        tests:
          - not_null

      - name: num_customers
        description: "Number of unique customers from the cohort who made a purchase in this order month."
        tests:
          - not_null

      - name: revenue
        description: "Total revenue generated by cohort customers in the given order month."
        tests:
          - not_null

  - name: customer_rfm_scores
    description: "Customer-level RFM metrics table for marketing segmentation, including recency, frequency, and monetary value."
    columns:
      - name: customer_id
        description: "Primary key referencing the customer dimension."
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id
      - name: first_order_date
        description: "Date of the customer's first order."
        tests:
          - not_null

      - name: last_order_date
        description: "Date of the customer's most recent order."
        tests:
          - not_null

      - name: frequency
        description: "Total number of orders placed by the customer."
        tests:
          - not_null

      - name: monetary
        description: "Total revenue generated by the customer across all orders."

      - name: recency_months
        description: "Number of days since the customer's last purchase relative to the current date."
        tests:
          - not_null


  - name: customer_segments
    description: "Customer segmentation mart based on RFM scores, classifying customers into segments like Champions, Loyal, At Risk, and Regular."
    columns:
      - name: customer_id
        description: "Primary key referencing the customer dimension."
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id
      - name: recency_month
        description: "Number of months since the customer's last purchase (copied from customer_rfm_scores)."

      - name: frequency
        description: "Total number of orders placed by the customer (copied from customer_rfm_scores)."
        tests:
          - not_null

      - name: monetary
        description: "Total revenue generated by the customer (copied from customer_rfm_scores)."

      - name: rfm_segment
        description: "Categorical segment assigned to the customer based on RFM rules (Champions, Loyal, At Risk, Regular)."
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["Champions", "Loyal", "At risk", "Regular"]
    config:
      meta:
        owner: "data-marketing"
        domain: "marketing"
        tags: ["mart", "marketing", "segments"]
