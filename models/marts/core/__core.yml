version: 2

models:
  - name: customer_mart
    description: "Aggregated customer-level metrics including purchase behavior, revenue, order counts, and customer lifetime."
    columns:
      - name: customer_id
        description: "Primary key referencing the customer dimension."
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id
      - name: customer_city
        description: "City of the customer."

      - name: customer_state
        description: "State of the customer."

      - name: customer_zip_code
        description: "Postal code of the customer."

      - name: first_order_date
        description: "Date of the customer's first order."
        tests:
          - not_null

      - name: last_order_date
        description: "Date of the customer's most recent order."

      - name: total_orders
        description: "Total number of orders placed by the customer."
        tests:
          - not_null

      - name: total_items_purchased
        description: "Total number of items purchased by the customer."

      - name: total_revenue
        description: "Total revenue generated by the customer."
        tests:
          - not_null

      - name: customer_lifetime_days
        description: "Number of days between the first and last order."

      - name: is_repeat_customer
        description: "Boolean indicating whether the customer has placed more than one order."

      - name: avg_order_value
        description: "Average revenue per order for the customer."

    config:
      meta:
        owner: "data-analytics"
        domain: "customer"
        tags: ["mart", "customer"]
  - name: payment_mart
    description: "Aggregated sales data by payment type, including order, customer, product, and seller information."
    columns:
      - name: order_id
        description: "Primary key of the order."
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('fact_orders')
                field: order_id
      - name: customer_id
        description: "Identifier of the customer who placed the order."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id
      - name: payment_type
        description: "Type of payment used (e.g., credit card, boleto, voucher)."
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["credit_card", "boleto", "voucher", "debit_card", "not_defined"]

      - name: payment_installments
        description: "Number of installments chosen for the payment."

      - name: payment_value
        description: "Total value of the payment for the order."
        tests:
          - not_null

      - name: product_id
        description: "Identifier of the product associated with the order item."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_product')
                field: product_id
      - name: product_category_name_english
        description: "English name of the product category."

      - name: seller_id
        description: "Identifier of the seller fulfilling the order item."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_seller')
                field: seller_id
      - name: seller_state
        description: "State in which the seller operates."
    config:
      meta:
        owner: "data-analytics"
        domain: "sales"
        tags: ["mart", "payments"]
  - name: sales_mart
    description: "Order-level sales fact table with aggregated metrics including delivery performance, payment details, and order counts."
    columns:
      - name: order_id
        description: "Primary key for each order."
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('fact_orders')
                field: order_id
      - name: customer_id
        description: "Foreign key referencing dim_customer."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_customer')
                field: customer_id
      - name: seller_id
        description: "Foreign key referencing dim_seller."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_seller')
                field: seller_id
      - name: purchased_date
        description: "Date when the order was purchased."

      - name: approved_date
        description: "Date when the order payment was approved."

      - name: delivered_carrier_date
        description: "Date when the order was handed to the carrier."

      - name: delivered_customer_date
        description: "Date when the order was delivered to the customer."

      - name: estimated_delivery_date
        description: "Estimated delivery date provided at purchase."

      - name: order_status
        description: "Status of the order (e.g., approved, delivered, canceled)."
        tests:
          - accepted_values:
              arguments:
                values: ["approved", "delivered", "unavailable", "invoiced", "processing", "shipped", "created", "canceled"]

      - name: total_order_value
        description: "Total value of the order including all items."
        tests:
          - not_null

      - name: total_items
        description: "Number of items in the order."
        tests:
          - not_null

      - name: delivery_days
        description: "Actual delivery duration in days (delivered_customer_date - purchase date)."

      - name: estimated_delivery_days
        description: "Estimated delivery duration in days (estimated_delivery_date - purchase date)."

      - name: is_delivered_on_time
        description: "Boolean indicating if the order was delivered on or before the estimated delivery date."

      - name: is_delayed
        description: "Boolean indicating if the order was delivered after the estimated delivery date."

      - name: payment_type
        description: "Type of payment used for the order."
        tests:
          - not_null

      - name: payment_installments
        description: "Average number of installments selected for this order."
    config:
      meta:
        owner: "data-analytics"
        domain: "sales"
        tags: ["mart", "sales"]