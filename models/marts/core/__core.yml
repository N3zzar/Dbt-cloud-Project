version: 2

models:
  - name: customer_mart
    description: >
      Customer-level mart providing a consolidated view of customer behavior,
      order outcomes, and delivered revenue. The table preserves all customer
      activity while deriving delivered-only value metrics for financial analysis.
    columns:
      - name: customer_id
        description: >
          Unique identifier for the customer. Grain of the table is one row per customer.

      - name: customer_city
        description: >
          City associated with the customer's primary address.

      - name: customer_state
        description: >
          State or region associated with the customer's primary address.

      - name: customer_zip_code
        description: >
          Postal or ZIP code associated with the customer's primary address.

      - name: first_order_date
        description: >
          Timestamp of the customer's first recorded order attempt,
          regardless of final order status.

      - name: last_order_date
        description: >
          Timestamp of the customer's most recent order attempt,
          regardless of final order status.

      - name: total_items_purchased
        description: >
          Total number of order items associated with the customer across all orders,
          including delivered, cancelled, and returned orders. This metric captures
          purchase intent and engagement.

      - name: total_orders
        description: >
          Total number of orders placed by the customer across all statuses,
          including delivered, cancelled, and returned orders.

      - name: delivered_orders
        description: >
          Number of orders that reached a delivered status for the customer.
          Used as the authoritative order count for revenue-based metrics.

      - name: delivered_revenue
        description: >
          Total revenue generated from delivered orders only. Cancelled and returned
          orders are excluded to reflect realized revenue.

      - name: cancelled_orders
        description: >
          Number of orders placed by the customer that were cancelled prior to delivery.

      - name: returned_orders
        description: >
          Number of delivered orders that were subsequently returned by the customer.

      - name: avg_order_value
        description: >
          Average revenue per delivered order, calculated as delivered_revenue
          divided by delivered_orders. Returns zero when the customer has no
          delivered orders.

  - name: sales_mart
    description: >
      Analytics-ready sales mart containing delivered orders only.
      The model is aggregated at one row per order and exposes revenue,
      item counts, payment attributes, and delivery performance metrics
      for reporting and analysis.

    columns:
      - name: order_id
        description: >
          Unique identifier of the order. Each row in this model represents
          exactly one delivered order.
        tests:
          - not_null

      - name: customer_id
        description: >
          Unique identifier of the customer who placed the order.
        tests:
          - not_null

      - name: purchased_date
        description: >
          Timestamp when the order was initially placed by the customer.
        tests:
          - not_null

      - name: approved_date
        description: >
          Timestamp when the order payment was approved.

      - name: delivered_carrier_date
        description: >
          Timestamp when the order was handed over to the carrier for delivery.

      - name: delivered_customer_date
        description: >
          Timestamp when the order was successfully delivered to the customer.

      - name: estimated_delivery_date
        description: >
          Estimated delivery date communicated to the customer at purchase time.

      - name: order_status
        description: >
          Current status of the order. This mart only includes orders
          with status equal to 'delivered'.
        tests:
          - not_null
          - accepted_values:
              values: ['delivered']

      - name: payment_type
        description: >
          Payment method used for the order (e.g., credit_card, debit_card, voucher).

      - name: payment_installments
        description: >
          Number of installments used to pay for the order.

      - name: total_order_value
        description: >
          Total monetary value of the order, calculated as the sum of all
          payment values associated with the order.

      - name: total_items
        description: >
          Total number of items included in the order.
        tests:
          - not_null

      - name: delivery_days
        description: >
          Number of days between order purchase and customer delivery.

      - name: estimated_delivery_days
        description: >
          Estimated number of days between order purchase and the expected
          delivery date.

      - name: is_delivered_on_time
        description: >
          Boolean flag indicating whether the order was delivered on or
          before the estimated delivery date.

      - name: is_delayed
        description: >
          Boolean flag indicating whether the order was delivered after
          the estimated delivery date.